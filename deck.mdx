import { CodeSurferLayout } from 'code-surfer'
export { nightOwlFull as theme } from 'code-surfer/themes'

# Hello üëã

You are using [MDX Deck](https://github.com/jxnblk/mdx-deck) and [Code Surfer](https://github.com/pomber/code-surfer)

---

<CodeSurferLayout>

```js title="The conventional Modal implementation"
import { Modal } from 'antd'
import React, { useState, useEffect } from 'react'
import { DeleteButton, EditButton } from './Button'
import { LeftIcon } from './Icon'
import { ReservationDetailEdit } from './ReservationDetailEdit'
import { ReservationDetailView } from './ReservationDetailView'
import { ReservationList } from './ReservationList'

export const ReservationModal = ({
  data,
  date,
  formattedDate,
  onCreate,
  onDelete,
  onUpdate,
  ...props
}) => {
  const [index, setIndex] = useState(-1)
  const [editing, setEditing] = useState(false)

  // Render details directly if data.length === 1
  useEffect(() => {
    if (data.length === 1) {
      setIndex(0)
    }
  }, [data.length, index, editing])

  const visible = !!date
  const isDetailView = visible && index >= 0
  const isEmpty = visible && data.length === 0
  const handleDelete = () => onDelete(date, index)
  const handleCreate = data => onCreate(date, data)
  const handleUpdate = data => onUpdate(date, index, data)
  const handleEdit = () => setEditing(true)
  const handleBack = () => {
    setEditing(false)
    setIndex(-1)
  }

  return (
    <Modal
      afterClose={() => {
        setEditing(false)
        setIndex(-1)
      }}
      centered
      footer={
        isDetailView && !editing && data[index].status === 'warning'
          ? [
              <DeleteButton key="delete" onClick={handleDelete} />,
              <EditButton key="edit" onClick={handleEdit} />,
            ]
          : null
      }
      title={
        <>
          {isDetailView && <LeftIcon onClick={handleBack} />}
          {formattedDate}
        </>
      }
      visible={visible}
      {...props}
    >
      {isDetailView && !editing ? (
        <ReservationDetailView item={data[index]} />
      ) : isDetailView && editing ? (
        <ReservationDetailEdit item={data[index]} onSubmit={handleUpdate} />
      ) : isEmpty ? (
        <ReservationDetailEdit onSubmit={handleCreate} />
      ) : (
        <ReservationList data={data} onActionClick={index => setIndex(index)} />
      )}
    </Modal>
  )
}
```

```js 28:30 subtitle="A bunch of computed state üòû"
import { Modal } from 'antd'
import React, { useState, useEffect } from 'react'
import { DeleteButton, EditButton } from './Button'
import { LeftIcon } from './Icon'
import { ReservationDetailEdit } from './ReservationDetailEdit'
import { ReservationDetailView } from './ReservationDetailView'
import { ReservationList } from './ReservationList'

export const ReservationModal = ({
  data,
  date,
  formattedDate,
  onCreate,
  onDelete,
  onUpdate,
  ...props
}) => {
  const [index, setIndex] = useState(-1)
  const [editing, setEditing] = useState(false)

  // Render details directly if data.length === 1
  useEffect(() => {
    if (data.length === 1) {
      setIndex(0)
    }
  }, [data.length, index, editing])

  const visible = !!date
  const isDetailView = visible && index >= 0
  const isEmpty = visible && data.length === 0
  const handleDelete = () => onDelete(date, index)
  const handleCreate = data => onCreate(date, data)
  const handleUpdate = data => onUpdate(date, index, data)
  const handleEdit = () => setEditing(true)
  const handleBack = () => {
    setEditing(false)
    setIndex(-1)
  }

  return (
    <Modal
      afterClose={() => {
        setEditing(false)
        setIndex(-1)
      }}
      centered
      footer={
        isDetailView && !editing && data[index].status === 'warning'
          ? [
              <DeleteButton key="delete" onClick={handleDelete} />,
              <EditButton key="edit" onClick={handleEdit} />,
            ]
          : null
      }
      title={
        <>
          {isDetailView && <LeftIcon onClick={handleBack} />}
          {formattedDate}
        </>
      }
      visible={visible}
      {...props}
    >
      {isDetailView && !editing ? (
        <ReservationDetailView item={data[index]} />
      ) : isDetailView && editing ? (
        <ReservationDetailEdit item={data[index]} onSubmit={handleUpdate} />
      ) : isEmpty ? (
        <ReservationDetailEdit onSubmit={handleCreate} />
      ) : (
        <ReservationList data={data} onActionClick={index => setIndex(index)} />
      )}
    </Modal>
  )
}
```

```js 48,57,64,66,68,70 subtitle="Implicit conditional rendering üò´"
import { Modal } from 'antd'
import React, { useState, useEffect } from 'react'
import { DeleteButton, EditButton } from './Button'
import { LeftIcon } from './Icon'
import { ReservationDetailEdit } from './ReservationDetailEdit'
import { ReservationDetailView } from './ReservationDetailView'
import { ReservationList } from './ReservationList'

export const ReservationModal = ({
  data,
  date,
  formattedDate,
  onCreate,
  onDelete,
  onUpdate,
  ...props
}) => {
  const [index, setIndex] = useState(-1)
  const [editing, setEditing] = useState(false)

  // Render details directly if data.length === 1
  useEffect(() => {
    if (data.length === 1) {
      setIndex(0)
    }
  }, [data.length, index, editing])

  const visible = !!date
  const isDetailView = visible && index >= 0
  const isEmpty = visible && data.length === 0
  const handleDelete = () => onDelete(date, index)
  const handleCreate = data => onCreate(date, data)
  const handleUpdate = data => onUpdate(date, index, data)
  const handleEdit = () => setEditing(true)
  const handleBack = () => {
    setEditing(false)
    setIndex(-1)
  }

  return (
    <Modal
      afterClose={() => {
        setEditing(false)
        setIndex(-1)
      }}
      centered
      footer={
        isDetailView && !editing && data[index].status === 'warning'
          ? [
              <DeleteButton key="delete" onClick={handleDelete} />,
              <EditButton key="edit" onClick={handleEdit} />,
            ]
          : null
      }
      title={
        <>
          {isDetailView && <LeftIcon onClick={handleBack} />}
          {formattedDate}
        </>
      }
      visible={visible}
      {...props}
    >
      {isDetailView && !editing ? (
        <ReservationDetailView item={data[index]} />
      ) : isDetailView && editing ? (
        <ReservationDetailEdit item={data[index]} onSubmit={handleUpdate} />
      ) : isEmpty ? (
        <ReservationDetailEdit onSubmit={handleCreate} />
      ) : (
        <ReservationList data={data} onActionClick={index => setIndex(index)} />
      )}
    </Modal>
  )
}
```

</CodeSurferLayout>

---

# State Machines to the Rescue!

## ü¶∏‚Äç‚ôÇÔ∏è ü¶∏‚Äç‚ôÄÔ∏è

---

# State Machine Introduction

---

<CodeSurferLayout>

```js 1:3,5 title="A simple toggle machine example"
import { Machine } from 'xstate'

const toggleMachine = Machine({
  //
})
```

```js 4:4 subtitle="Initial state"
import { Machine } from 'xstate'

const toggleMachine = Machine({
  initial: 'inactive',
})
```

```js 5:6,8:9,11 subtitle="States"
import { Machine } from 'xstate'

const toggleMachine = Machine({
  initial: 'inactive',
  states: {
    inactive: {
      //
    },
    active: {
      //
    },
  },
})
```

```js 7:9,12:14 subtitle="Events"
import { Machine } from 'xstate'

const toggleMachine = Machine({
  initial: 'inactive',
  states: {
    inactive: {
      on: {
        TOGGLE: 'active',
      },
    },
    active: {
      on: {
        TOGGLE: 'inactive',
      },
    },
  },
})
```

```js 3:17 subtitle="Copy these lines"
import { Machine } from 'xstate'

const toggleMachine = Machine({
  initial: 'inactive',
  states: {
    inactive: {
      on: {
        TOGGLE: 'active',
      },
    },
    active: {
      on: {
        TOGGLE: 'inactive',
      },
    },
  },
})
```

</CodeSurferLayout>

---

# Visualize

Paste to the <a target="\_blank" href="https://statecharts.github.io/xstate-viz/">XState visualizer</a>

---

<CodeSurferLayout>

```js 3 title="Let's build the Modal Machine"
import { Machine } from 'xstate'

const modalMachine = Machine({
  //
})
```

```js 4:6,8:9,11 subtitle="We have 2 states: invisible & visible"
import { Machine } from 'xstate'

const modalMachine = Machine({
  initial: 'invisible',
  states: {
    invisible: {
      //
    },
    visible: {
      //
    },
  },
})
```

```js 7:9,12:14 subtitle="We have 2 events: OPEN & CLOSE"
import { Machine } from 'xstate'

const modalMachine = Machine({
  initial: 'invisible',
  states: {
    invisible: {
      on: {
        OPEN: 'visible',
      },
    },
    visible: {
      on: {
        CLOSE: 'invisible',
      },
    },
  },
})
```

```js 3:17 subtitle="Copy these lines"
import { Machine } from 'xstate'

const modalMachine = Machine({
  initial: 'invisible',
  states: {
    invisible: {
      on: {
        OPEN: 'visible',
      },
    },
    visible: {
      on: {
        CLOSE: 'invisible',
      },
    },
  },
})
```

</CodeSurferLayout>

---

# Visualize

Verify again in the <a target="\_blank" href="https://statecharts.github.io/xstate-viz/">XState visualizer</a>
